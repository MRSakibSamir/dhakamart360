<div class="table-responsive">
  <table class="table table-sm align-middle">
    <thead class="table-light">
      <tr>
        <th style="width:38%">Product</th>
        <th style="width:18%">Price (৳)</th>
        <th style="width:18%">Qty</th>
        <th class="text-end" style="width:20%">Line Total (৳)</th>
        <th class="text-end" style="width:6%"></th>
      </tr>
    </thead>
    <tbody formArrayName="items">
      <tr *ngFor="let row of items.controls; let i = index" [formGroupName]="i">
        <td>
          <select class="form-select" formControlName="productId" (change)="onProductChange(i)">
            <option [ngValue]="null">-- Select --</option>
            <option *ngFor="let p of products" [ngValue]="p.id">{{ p.name }}</option>
          </select>
        </td>
        <td>
          <input type="number" step="0.01" min="0" class="form-control" formControlName="price">
        </td>
        <td>
          <input type="number" min="1" class="form-control" formControlName="qty" (input)="onQtyChange(i)">
        </td>
        <td class="text-end">
          {{ lineTotal(i) | number:'1.2-2' }}
        </td>
        <td class="text-end">
          <button type="button" class="btn btn-sm btn-outline-danger" (click)="removeItem(i)">×</button>
        </td>
      </tr>
    </tbody>
    <tfoot>
      <tr>
        <th>Total</th>
        <th></th>
        <th>{{ totalQuantity() }}</th>
        <th class="text-end">{{ subtotal | number:'1.2-2' }}</th>
        <th></th>
      </tr>
      <tr>
        <th colspan="3" class="text-end">Discount (৳)</th>
        <th class="text-end">
          <input type="number" class="form-control form-control-sm text-end" formControlName="discount">
        </th>
        <th></th>
      </tr>
      <tr>
        <th colspan="3" class="text-end">Tax ({{ form.get('taxRate')?.value || 0 }}%)</th>
        <th class="text-end">{{ taxAmount | number:'1.2-2' }}</th>
        <th></th>
      </tr>
      <tr>
        <th colspan="3" class="text-end">Grand Total</th>
        <th class="text-end">{{ grandTotal | number:'1.2-2' }}</th>
        <th></th>
      </tr>
    </tfoot>
  </table>
  <button type="button" class="btn btn-sm btn-outline-primary mt-2" (click)="addItem()">+ Add Item</button>
</div>
